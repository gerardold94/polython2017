<link rel="import" href="../bower_components/polymer/polymer-element.html">
<link rel="import" href="../bower_components/paper-card/paper-card.html">
<link rel="import" href="../bower_components/paper-input/paper-input.html">
<link rel="import" href="../bower_components/polymerfire/firebase-document.html">

<link rel="import" href="shared-styles.html">

<link rel="import" href="components/balance-bar.html">
<link rel="import" href="components/user-info.html">
<link rel="import" href="components/badge.html">

<dom-module id="my-home">
  <template>
    <style include="shared-styles">
      :host {
        margin: 8px;
      }
      div {
        display: flex;
        align-items: center;
        justify-content: center;
      }
      
      balance-bar {
        flex: 0.7;
      }

      my-badge {
        margin: 1rem;
      }

      .badges {
        display: block;
        margin: 0 auto;
        padding: 1rem;
        width: 80%;
      }

      .green {
        --badge-background-color: #35ad88;
      }

      .blue {
        --badge-background-color: #45a2dd;
      }

      @media (max-width: 600px) {
        balance-bar {
          flex: 0.8;
        }
      }
    
    </style>
    <user-info user="[[user]]"></user-info>

    <firebase-document
      id="query"
      path="/users/[[user.uid]]"
      data="{{data}}">
    </firebase-document>

    <div>
      <balance-bar current-progress="[[data.amount]]" next-deposit="[[_nextDeposit(data.amount)]]" goal="[[data.goal]]"></balance-bar>
    </div>
    <div class="badges">
      <h3>Medallas</h3>
      <hr>
      <template is="dom-repeat" items="[[badges]]">
        <my-badge
          image="[[item.image]]"
          text="[[item.text]]">
        </my-badge>
      </template>
    </div>
    {{badges}}
  </template>

  <script>
    class MyHomeView extends Polymer.Element {
      ready () {
        super.ready();
        this.user = {
          userName: 'Juan PÃ©rez',
          cardNumber: '****-****-****-1234',
          accountNumber: '1234562',
          profileImage: 'http://ulbcnj.org/wp-content/uploads/2015/05/placeholder.png'
        }
      }

      static get is() { return 'my-home'; }

      static get properties() {
        return {
          images: {
            type: Array,
            value: [
              {
                image: 'https://image.flaticon.com/icons/png/128/150/150271.png',
                color: 'green',
                disabled: false
              },
              {
                image: 'https://image.flaticon.com/icons/png/128/587/587879.png',
                color: 'blue',
                disabled: true
              },
              {
                image: 'https://image.flaticon.com/icons/png/128/150/150271.png',
                color: 'green',
                disabled: true
              },
              {
                image: 'https://image.flaticon.com/icons/png/128/587/587879.png',
                color: 'blue',
                disabled: false
              }
            ]
          },
          badges: {
            type: Object,
            value: Array
          },
          user: {
            type: Object,
            value: false
          },
          data: {
            type: Object,
            observer: 'dataChanged'
          },
          uid: String
        };
      }

      _nextDeposit(amount) {
        return amount + 500;
      }

      dataChanged (newData, oldData) {
        this.badges = [];    
        this.userData = null;    
        if (!newData.amount || !newData.goal) return;
        if (newData.badges) {
          newData.badges.forEach(element => {
            this.badges.push(element);
          });
        }
      }
    }
    window.customElements.define(MyHomeView.is, MyHomeView);
  </script>
</dom-module>